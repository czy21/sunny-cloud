["clean", "build"].forEach { t ->
    tasks.register("${t}") {
        gradle.getIncludedBuilds().each {p->
            file("${p.name}").eachDirMatch(~/${p.name}-.*/) { m ->
                dependsOn gradle.includedBuild("${p.name}").task(":${m.name}:${t}")
            }
            if (file("${p.name}/src").exists()) {
                dependsOn gradle.includedBuild("${p.name}").task(":${t}")
            }
        }
    }
}